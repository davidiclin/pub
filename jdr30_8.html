<!DOCTYPE html>
<html>
<style>
#searchPanel {
  position: fixed;
  margin-left: auto;
  margin-right: auto;
  top: 0px;
  left: 0px;
  width: 100%;
  background-color: LightSteelBlue;
  border-spacing: 2;
  z-index: 1;
}
#panelSwitch {
  width: 10%;
}
#searchPanelUpper {
  width: 250px;
  background-color: LightSteelBlue;
  position: absolute;
  top: 16px;
  left: 0px;
  padding: 5px;
  display: none;
  align: left;
}
#searchCity {
  width: 175px;
}
#searchResult {
  display: none;
  width: 225px;
}
#searchPanelLower {
  display: none;
}
#startCol {
  width: 20%;
}
.cityTag {
  margin-left: 2px;
  margin-right: 2px;
  padding: 2px;
  background-color: White;
  cursor: default;
  font-family: Arial, Helvetica, sans-serif;
}
#subject {
  position: relative;
  margin-left: auto;
  margin-right: auto;
  margin-top: 30px;
  width: 1620px;
  height: 810px;
  border: none;
  background-image: url("Worldmap08a.png");
  background-repeat: repeat;
  background-position: 0px;
  z-index: 0;
}
#myCanvas {
  position: absolute;
  top: 0px;
  left: 0px;
  font-family: Arial, Helvetica, sans-serif;
}
/* #scrollLeft {
  position: absolute;
  top: 40%;
  left: 0%;
  opacity: 33%;
}
#scrollRight {
  position: absolute;
  top: 40%;
  left: 97%;
  opacity: 33%;
} */
#imgSource {
  text-align: center;
}
</style>
<body>
<section>
  <table id="searchPanel">
    <tr><td id="startCol"><button id="panelSwitch" onclick="switchPanel()">+</button>
        <button id="mapZoom" onclick="zoomMap()">Large Map</button></td>
        <td id="tagCol"></td>
    </tr>
    <tr><td class="leftCol">
      <p id="searchPanelUpper">
        <label for="searchCity"></label>
        <input type="text" id="searchCity" value="Enter City Name">
        <button onclick="searchIt()">Search</button>
        <br>
        <span id="showSearchResult"></span>
        <br>
        <label for="searchResult"></label>
        <select id="searchResult" size=2>
        </select>
        <br>
      <segment id="searchPanelLower">
        <label for="pinColor">Select pin color:</label>
        <input type="color" id="pinColor" name="pinColor" value="#0000ff">
        <br>
        <br>
        <button onclick="pinIt()">Add</button>
        <br>
        <br>
      </segment>
      </p>
    </td><td></td></tr>
  </table>
</section>
<section>
  <table id="subject" onclick="showCoords(event)">
    <tr><td id="myMap">
    <canvas id="myCanvas" width="1620" height="810" style="border:1px solid #000000;"></canvas>
    <!-- <img id="scrollLeft" onclick="scrollMap(-270)" src="leftScroll.png">
    <img id="scrollRight" onclick="scrollMap(270)" src="rightScroll.png"> -->
    </td></tr>
  </table>
</section>
<p id="imgSource">Map file: <a href="https://commons.wikimedia.org/wiki/File:World_location_map.svg" target="_blank">https://commons.wikimedia.org/wiki/File:World_location_map.svg</a></p>
<p><strong>Tip:</strong> Try to click different places in the heading.</p>

<p id="demo"></p>
<p id="demo1"></p>
<p id="demo2"></p>
<p id="demo3"></p>

<script>
var getCities = new XMLHttpRequest(); // a new request
getCities.open("GET","https://davidiclin.github.io/pub/Cities.json",false);
getCities.send(null);
const cities = JSON.parse(getCities.responseText);
var longZero = 810;
var scale = 4.5;
var pinList = [];
var cityCandidates;
var panelOn = 0;

function searchIt() {
  cityCandidates = [];
  document.getElementById("searchResult").innerHTML = "";
  for (count = 0; count < cities.length; count++) {
    if (document.getElementById("searchCity").value === cities[count].nameE) {
      document.getElementById("searchResult").style.display = "block";
      document.getElementById("searchPanelLower").style.display = "block";
      document.getElementById("searchResult").innerHTML += "<option value=\"" + cities[count].nameE + " (" + cities[count].ctryE + ")\">" + cities[count].nameE + " (" + cities[count].ctryE + ")</option>";
      cityCandidates.push(cities[count]);
    }
  if (cityCandidates.length === 0) {
    document.getElementById("showSearchResult").innerHTML = "City not found";
    document.getElementById("searchResult").style.display = "none";
    document.getElementById("searchPanelLower").style.display = "none";
  }
  else {
    document.getElementById("showSearchResult").innerHTML = cityCandidates.length + "match(es) found";
    document.getElementById("searchResult").selectedIndex = "0";
  }
  }
}

function showCoords(event) {
  var x = event.clientX;
  var y = event.clientY;
  var x1 = event.offsetX;
  var y1 = event.offsetY;
  var x2 = event.pageX;
  var y2 = event.pageY;
  var coords = "CLIENT - X coords: " + x + ", Y coords: " + y;
  document.getElementById("demo").innerHTML = coords;
  var coords1 = "OFFSET - X coords: " + x1 + ", Y coords: " + y1;
  document.getElementById("demo1").innerHTML = coords1;
  var coords2 = "PAGE - X coords: " + x2 + ", Y coords: " + y2;
  document.getElementById("demo2").innerHTML = coords2;
  var longitude = Math.floor((x1 - longZero) / 4.5 * 10) / 10;
  if (longitude > 180) {
    longitude = longitude - 360;
  }
  if (longitude < -180) {
    longitude = longitude + 360;
  }
  var latitude =  - Math.floor((y1 - 405) /4.5 * 10) / 10;
  var coord3 = "WORLD - Longitude: " + longitude + ", Latitude: " + latitude;
  document.getElementById("demo3").innerHTML = coord3;
}

// function scrollMap(x) {
//   longZero += x;
//   if (longZero > 1620) {
//     longZero -= 1620;
//   }
//   if (longZero < 0) {
//     longZero += 1620;
//   }
//   document.getElementById("subject").style.backgroundPosition = (longZero - 810) + "px";
//   document.getElementById("myCanvas").style.left = (longZero - 810) + "px";
//
// }

function pinIt() {
  pinList.push(cityCandidates[document.getElementById("searchResult").selectedIndex]);
  pinList[pinList.length - 1].color = document.getElementById("pinColor").value;
  document.getElementById("tagCol").innerHTML += "<span class=\"cityTag\" id=\"" + pinList[pinList.length -1].id + "\">" + "&#11044; " + pinList[pinList.length -1].nameE + "</span>";
  document.getElementById(pinList[pinList.length -1].id).style.color = pinList[pinList.length -1].color;
  document.getElementById("searchCity").value = "Enter City Name";
  document.getElementById("showSearchResult").innerHTML = "";
  document.getElementById("searchResult").style.display = "none";
  document.getElementById("searchPanelLower").style.display = "none";
  renderIt(pinList);
  // console.log(pinList);
}

function renderIt(x) {
  var canvas = document.getElementById("myCanvas");
  var ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, 360 * scale, 180 * scale);
  for (count = 0; count < x.length; count++) {
    var mapX = scale * x[count].long + longZero;
    var mapY = 180 * scale / 2 - scale * x[count].lat;
    ctx.beginPath();
    ctx.arc(mapX, mapY, 5, 0, 2 * Math.PI);
    ctx.fillStyle = x[count].color;
    ctx.fill();
    ctx.font = "15px Arial";
    ctx.fillText(x[count].nameE, mapX + 10, mapY + 5)
  }
}

function zoomMap() {
  if (scale === 4.5) {
    scale = 9;
    document.getElementById("subject").style.width = "3240px";
    document.getElementById("subject").style.height = "1620px";
    document.getElementById("myCanvas").width = "3240";
    document.getElementById("myCanvas").height = "1620";
    document.getElementById("subject").style.backgroundImage = "url('Worldmap09a.png')";
    longZero = 1620;
    renderIt(pinList);
    document.getElementById("mapZoom").innerHTML = "Small Map";
  }
  else {scale = 4.5;
    document.getElementById("subject").style.width = "1620px";
    document.getElementById("subject").style.height = "810px";
    document.getElementById("myCanvas").width = "1620";
    document.getElementById("myCanvas").height = "810";
    document.getElementById("subject").style.backgroundImage = "url('Worldmap08a.png')";
    longZero = 810;
    renderIt(pinList);
    document.getElementById("mapZoom").innerHTML = "Large Map";
  }
}

function switchPanel() {
  if (panelOn === 0) {
    document.getElementById("searchPanelUpper").style.display = "block";
    document.getElementById("panelSwitch").innerHTML = "-";
    panelOn = 1;
  }
  else {
    document.getElementById("showSearchResult").innerHTML = "";
    document.getElementById("searchResult").style.display = "none";
    document.getElementById("searchPanelUpper").style.display = "none";
    document.getElementById("searchPanelLower").style.display = "none";
    document.getElementById("panelSwitch").innerHTML = "+";
    panelOn = 0;
  }
}
</script>

</body>
</html>
